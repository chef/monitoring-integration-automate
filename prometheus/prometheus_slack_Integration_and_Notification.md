# Slack Integration and Notification
Connect Slack to Prometheus to:

* All alerts must be sent to Slack.

What you’ll need:

 * Admin or Standard role permissions for your prometheus account (unless your organization has created custom role)
 * Permissions to create new channel in Slack 

## prometheus and Slack Integration
### Prerequisites
The following steps provides the guidance to prepare Slack receiver for the alert manager to send alerts. 

* Slack Notification  
    Refer to this [guide](https://grafana.com/blog/2020/02/25/step-by-step-guide-to-setting-up-prometheus-alertmanager-with-slack-pagerduty-and-gmail/) for step-by-step guidance to configure Slack notification fo the prometheus alert manager.

* After creating the channel, copy the api url. e.g. `https://hooks.slack.com/services/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`.

* This api_url will be used in alertmanager configuration.

### Configure AlertManager for Slack

Before performing the following steps, please ensure alertmanager is installed and configured to run as a service. Refer to the ![alertmanger installation guide](./Prometheus_Monitor_configuration_and_alerting.md)

* Perform the following steps to configure alert manager to integration with Slack. 

* Update the api_key generated by Slack.

Please note: The webhooks provided in the following configuration are tampered. The webhooks must be updated as per the environment.

```
vi /etc/alertmanager/alertmanager.yml
```

```
route:
  # A default receiver
  receiver: slack

  routes:
    - match:
        severity: page
      continue: true
      receiver: slack

receivers:
  - name: slack
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/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'
        send_resolved: true
        channel: '#prometheus-monitoring'
        title: |-
          [{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }} for {{ .CommonLabels.job }}
          {{- if gt (len .CommonLabels) (len .GroupLabels) -}}
            {{" "}}(
            {{- with .CommonLabels.Remove .GroupLabels.Names }}
              {{- range $index, $label := .SortedPairs -}}
                {{ if $index }}, {{ end }}
                {{- $label.Name }}="{{ $label.Value -}}"
              {{- end }}
            {{- end -}}
            )
          {{- end }}
        text: >-
          {{ range .Alerts -}}
          *Alert:* {{ .Annotations.title }}{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }}

          *Description:* {{ .Annotations.description }}

          *Details:*
             {{ range .Labels.SortedPairs }} • *{{ .Name }}:* `{{ .Value }}`
             {{ end }}
          {{ end }}
```

Run the following command to restart alert manager service

```
systemctl daemon-reload
systemctl start alertmanager
systemctl status alertmanager
```
